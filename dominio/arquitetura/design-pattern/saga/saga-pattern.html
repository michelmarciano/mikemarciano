<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../../css/default.css">
    <link rel="stylesheet" href="saga-coreografado.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Next:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
    
<title>Saga Pattern</title>
</head>
<body>
    <h1>Saga</h1>

    <img src="https://live.staticflickr.com/65535/54304198436_d6540294c3_z.jpg" alt="">
   
        <h2>O que √© modelo Saga Pattern?</h2>

        <p> O padr√£o arquitetural Saga ajuda a manter a consist√™ncia dos dados em sistemas distribuidos, uma saga √© uma sequ√™ncia de transa√ß√µes 
            locais onde cada servi√ßo executa sua opera√ß√£o e inicia a proxima etapa por meio de eventos ou mensagens. Se uma etapa na 
            sequ√™ncia falhar, a saga executa transa√ß√µes compensat√≥rias para desfazer as etapas conclu√≠das, mantendo a consist√™ncia dos dados.
        </p>
        <p>
            O termo Saga vem do sentido literal de Saga, que o conceito remete a uma aventura, uma hist√≥ria, uma jornada do her√≥i, jornada na
            qual a mesma remonta v√°rios cap√≠tulos onde o ‚Äúher√≥i‚Äù precisa cumprir objetivos, enfrentar desafios, superar certos limites e concluir 
            um objetivo predestinado. Dentro de uma implementa√ß√£o do Saga Pattern, uma Saga possui uma caracter√≠stica sequencial, na qual a 
            transa√ß√£o depende de diversos microservi√ßos para ser conclu√≠da, com etapas que devem ser executadas uma ap√≥s a outra de forma ordenada 
            e distribu√≠da. Lembrando que a proposta do modelo Saga √© garantir confiabilidade e consistencia n√£o perfomance.
        </p>
        
        <h2>A Origem do Saga Pattern</h2>
        
        <p>O Saga Pattern foi publicado pela primeira vez por Hector Garcia-Molina e Kennth Salem, em 1987 em um artigo para o Departamento de 
            Ci√™ncias da Computa√ß√£o da Universidade de Princeton, intitulado <a href="https://www.cs.cornell.edu/andru/cs711/2002fa/reading/sagas.pdf"> 
            <strong>SAGAS</strong></a>. O objetivo do artigo √© enfrentar a problematica das Long Live Transactions (LLTs) nos computadores da √©poca, 
            quando j√° se buscava uma forma de lidar com processos que demandavam mais tempo que as opera√ß√µes tradicionais e n√£o podiam simplesmente
            bloquear os recursos computacionais at√© sua conclus√£o.    
        </p>

        <h2>O problema de lidar com transa√ß√µes distribu√≠das</h2>

        <p>
            Uma transa√ß√£o √© basicamente uma sequ√™ncia de opera√ß√µes que acontecem em multiplos sistemas para ser conclu√≠da. Por defini√ß√£o visa garantir que 
            todas sejam executadas, ou nenhuma, caso uma das opera√ß√µes falhe. Uma transa√ß√£o se torna distribuida quando ativa opera√ß√µes em v√°rios 
            servidores diferentes
        </p>


        <h2>O problema de lidar com transa√ß√µes longas</h2>

        <p>
            Em diversos cen√°rios, processos complexos exigem um periodo um pouco mais longo para serem concluidos em sua totalidade, 
            podendo aumentar o risco de falhas, por exemplo uma transa√ß√£o pra reservar uma viagem, que consiste em reservar um voo, 
            um carro alugado e um hotel, o tempo de espera da execu√ß√£o pode levar desde milissegundos at√© dias para ser finalizada 
            completamente.
        </p>
        
        <section>
            <h2>Modelo Coreografado </h2>

            <h1>Exemplo de Padr√£o Saga - E-commerce</h1>
            <div class="saga-container">
                <div id="criar-pedido" class="step pending">
                    <h2>1. Pedido</h2>
                    <p>Status: Pendente</p>
                    <div class="step-icon">
                        <div class="icon-normal">üìã</div>
                        <div class="icon-success">‚úÖ</div>
                        <div class="icon-failed">‚ùå</div>
                        <div class="icon-compensating">‚Ü©Ô∏è</div>
                    </div>
                </div>
                <div id="processar-pagamento" class="step pending">
                    <h2>2. Pagamento</h2>
                    <p>Status: Pendente</p>
                    <div class="step-icon">
                        <div class="icon-normal">üí≥</div>
                        <div class="icon-success">‚úÖ</div>
                        <div class="icon-failed">‚ùå</div>
                        <div class="icon-compensating">‚Ü©Ô∏è</div>
                    </div>
                </div>
                <div id="verificar-estoque" class="step pending">
                    <h2>3. Estoque</h2>
                    <p>Status: Pendente</p>
                    <div class="step-icon">
                        <div class="icon-normal">üì¶</div>
                        <div class="icon-success">‚úÖ</div>
                        <div class="icon-failed">‚ùå</div>
                        <div class="icon-compensating">‚Ü©Ô∏è</div>
                    </div>
                </div>
                <div id="realizar-entrega" class="step pending">
                    <h2>4. Entrega</h2>
                    <p>Status: Pendente</p>
                    <div class="step-icon">
                        <div class="icon-normal">üöö</div>
                        <div class="icon-success">‚úÖ</div>
                        <div class="icon-failed">‚ùå</div>
                        <div class="icon-compensating">‚Ü©Ô∏è</div>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button id="start-saga">Iniciar Saga</button>
                <button id="start-saga-fail-payment">Falha no Pagamento</button>
                <button id="start-saga-fail-stock">Falha no Estoque</button>
                <button id="start-saga-fail-delivery">Falha na Entrega</button>
                <button id="reset-saga">Resetar</button>
            </div>
            <div id="saga-status">
                <p>Status Geral: Pronto para iniciar</p>
            </div>
            
            <div id="transaction-container"></div>
        
            <script src="saga-coreografado.js"></script>

            <p>
                O modelo Coreografado prop√µe que o microservico deve conhecer o servi√ßo seguinte e o anterior, quando um microservi√ßo √©
                chamado ele executa seu processo e encaminha um evento para o microservi√ßo seguinte e assim sucessivamnete at√© a finalizacao da saga. 
            </p>


            <p>
                A mesma l√≥gica √© aplicada em operacoes de compensa√ß√£o e roolback onde o servi√ßo que falhou √© obrigado a notificar o anterior e assim 
                sucessivamnete at√© a finalizacao da saga. 
            </p>

            <h2>Quando Usar?</h2>    
             
            <ul>
                <li>Estrat√©gia bastante recomendada para aquitetura que est√° em est√°gio inicial de desenvolvimento, evita a 
                    necessidade de manter mais um servi√ßo de orquestra√ß√£o e n√£o tem retrabalho de Implementa√ß√£o devido ao novo 
                    surgiento da arquitetura.
                </li>
            </ul>


            <h2>Vantagens </h2>

            <ul>
                <li>
                    N√£o h√° necessidade de manter mais um servi√ßo
                </li>

                <li>
                    Excelente para arquiteturas ou fluxos de transa√ß√µes pequenas, que n√£o envolvam muitos servicos.
                </li>

                <li>
                    √â preferencial que seja implementado caso a arquitetura esteja nascendo, onde os fluxos ainda nao est√£o definidos e envolvendo 
                    v√°rios servi√ßos.
                </li>
            </ul>

            <h2>Desvantagens </h2>

            <ul>
                <li> 
                    Maior complexidade para entender e manter a l√≥gica conforme ocorra um grande cresciento do fluxo de transa√ß√µes.
                </li>

                <li> 
                    Os microservicos n√£o s√£o independentes, eles precisam conhecer quem ven antes ou depois no fluxo de execu√ß√£o.
                </li>
                <li> 
                    Pode ser mais complexo de ser testado devido o conhecimento geral dos microsservi√ßos envolvidos.
                </li>
            </ul>
            
        </section>

        <section>
            <h2>Modelo Orquestrado </h2>

            <p>
                O modelo Orquestrado           
            </p>

            <h2>Quando Usar?</h2>     
            <ul>
                <li>Estrat√©gia bastante recomendada para aquitetura j√° existente de microservi√ßos que ainda n√£o utilize saga e que possua
                    v√°rios servi√ßos implamentados, pois acopla toda a l√≥gica de orquestra√ß√£o e apenas um local.
                </li>
            </ul>

            <h2>Vantagens </h2>

            <ul>
                <li>
                    Toda a l√≥gica da saga fica em apenas um local centralizado, diinuindo a possibilidade de falhas em rela√ß√£o √† orquestra√ß√£o 
                    dos eventos.
                </li>
                <li>
                    Maior testabilidade dos fluxos.
                </li>
                <li>
                    Os microservi√ßos envolvidos s√£o totalmente independentes, n√£o possuem o minimo de conhecimento sobre a orquestra√ß√£o, facilitando
                    na implementa√ß√£o e compreens√£o dos fluxo unitariamente.
                </li>
            </ul>   

            <h2>Desvantagens </h2>

            <ul>
                <li> ]
                    <strong> √önico ponto de falha:</strong> o orquestrador pode se tornar um ponto √∫nico de falha porque coordena toda a transa√ß√£o. 
                    Em alguns casos, o padr√£o de coreografia da saga √© preferido por causa dessa quest√£o.
                </li>
            </ul>
            
        </section>


        <h2>Quando usar?</h2>     
        <ul>
            <li>Seu sistema exige integridade e consist√™ncia de dados em transa√ß√µes distribu√≠das que abrangem v√°rios reposit√≥rios de dados.</li>
        </ul>

    
        
        <section>
            <h3>Referencias</h3>
                <ul>
                    <li><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/saga">microsoft</a></li>
                </ul>
        </section>      

        </body>

</html>